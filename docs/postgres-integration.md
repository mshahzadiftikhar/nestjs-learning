# Installation 
You can install postgres on your system using any of following methods:
### Use Docker
Details to follow ... 
### Use Local Installation  
 - Installer is available at: https://www.enterprisedb.com/downloads/postgres-postgresql-downloads 
 - After successfull installation, open terminal and login into database. Make sure that `psql` is in your PATH.
    ```
    psql -U postgres
    ```
    Here postgres is the username. We specified it during the installation. Enter your password to login. It will open up postgres shell
    ```
    postgres=#
    ```
 - Create new database for testing purpose
    ```
    postgres=# CREATE DATABASE test_db;
    CREATE DATABASE
    ```
    You can verify it using `\list` command. 
- You can use `\c` to verify current database. It can be changed using `\c test_db`

# Connect from NestJS

### Creating env file
Lets create .env file for specifying all properties related to database so that these values aren't embedded in our code. This .env file is not committed in repos and is used for local environment.
```
DB_HOST=localhost
DB_PORT=5432
DB_USERNAME=postgres
DB_PASSWORD=postgres
DB_NAME=test_db
```
### Install Required Packages
```
npm install --save @nestjs/typeorm typeorm pg @nestjs/config
```
| Package           | Purpose                                  |
| ----------------- | ---------------------------------------- |
| `@nestjs/typeorm` | Integrates TypeORM with NestJS           |
| `typeorm`         | Core ORM library                         |
| `pg`              | PostgreSQL database driver for Node.js   |
| `@nestjs/config`  | Loads `.env` and manages config globally |

### Create Entity/Table Class

This class will be used as database table

```
import { Entity, PrimaryGeneratedColumn, Column } from 'typeorm';

@Entity()
export class Task {
  @PrimaryGeneratedColumn() // autogenerated primary key
  id: number;

  @Column()
  name: string;

  @Column()
  description: string;
}
```
### Update Task Module

Add the entity created above in task module: [tasks.module.ts](../src/tasks/tasks.module.ts)
```
@Module({
  imports: [TypeOrmModule.forFeature([Task])],
  controllers: [TasksController],
  providers: [TasksService],
})
```

### Register Config & TypeORM Modules

Register config and typeorm modules in [app.module.ts](../src/app.module.ts)
```
imports: [
  ConfigModule.forRoot({ isGlobal: true }), // loads .env
  TypeOrmModule.forRoot({
    type: 'postgres',
    host: process.env.DB_HOST,
    port: parseInt(process.env.DB_PORT ?? '5432', 10),
    username: process.env.DB_USERNAME,
    password: process.env.DB_PASSWORD,
    database: process.env.DB_NAME,
    entities: [Task],
    synchronize: true, // Dev only; on production, set to false - use migrations instead
  }),
  TasksModule,
],
```
### Use Repository in Service

In Service class, use the repository to get access to data.
Add constructor:
```
constructor(
   @InjectRepository(Task)
   private tasksRepository: Repository<Task>,
 ) {}
```

Update methods:
```
// select * from tasks 
getAllTasks() {
    return this.tasksRepository.find();
}

// select * from tasks where id = :id
getById(id: number) {
    return this.tasksRepository.findOneBy({ id });
}
```
